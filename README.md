# Aè‚¡æ‰“æ¿æç¤ºå·¥å…·

ä¸ªäººè‡ªç”¨ç›˜ä¸­"é€‰è‚¡/æ‰“æ¿æç¤º"å·¥å…·ï¼Œæä¾›å€™é€‰æ± ç­›é€‰ã€è§¦å‘æç¤ºã€ä»“ä½å»ºè®®å’Œå¤ç›˜åŠŸèƒ½ã€‚

## åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½
- ğŸ“Š **å¸‚åœºæƒ…ç»ªä»ªè¡¨ç›˜**ï¼šæ¶¨åœæ•°ã€ç‚¸æ¿ç‡ã€è·Œåœæ•°ã€é£é™©ç¯
- ğŸ“‹ **å€™é€‰æ± ç®¡ç†**ï¼šå®æ—¶è¯„åˆ†æ’åºï¼Œæ”¯æŒç­›é€‰å’Œè‡ªé€‰
- ğŸ”” **æç¤ºå¡ç³»ç»Ÿ**ï¼šå¯æ‰§è¡Œæç¤º + æ¡ä»¶è§£é‡Š + ä»“ä½å»ºè®®
- ğŸ’¼ **æŒä»“ä¸é£æ§**ï¼šä»“ä½æ§åˆ¶ã€è¿äºåœæ‰‹ã€å›æ’¤æ§åˆ¶
- ğŸ“ˆ **å¤ç›˜ç³»ç»Ÿ**ï¼šå†å²å›æ”¾ã€å¤±è´¥åˆ†æã€å‚æ•°å»ºè®®

### ç­–ç•¥æ”¯æŒ
- **å›å°ä¸»ç­–ç•¥ (reseal_v1)**ï¼šè¿½è¸ªå¼€æ¿åå¿«é€Ÿå›å°çš„æ ‡çš„
- **é¦–å°ä¿å®ˆç­–ç•¥ (firstseal_guard_v1)**ï¼šåœ¨è‰¯å¥½ç¯å¢ƒä¸‹è¿½è¸ªé¦–æ¬¡å°æ¿

### æŠ€æœ¯ç‰¹ç‚¹
- å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- WebSocket å®æ—¶æ¨é€
- æ•°æ®å»¶è¿Ÿè‡ªåŠ¨é™çº§
- å¿«ç…§å›æ”¾æ”¯æŒ

## æŠ€æœ¯æ¶æ„

```
â”œâ”€â”€ backend/          # FastAPI åç«¯
â”‚   â”œâ”€â”€ adapters/     # æ•°æ®é€‚é…å™¨ (adata)
â”‚   â”œâ”€â”€ api/          # REST + WebSocket API
â”‚   â”œâ”€â”€ core/         # æ ¸å¿ƒæ¨¡å— (æ—¥å†ã€QAã€é…ç½®)
â”‚   â”œâ”€â”€ features/     # ç‰¹å¾å¼•æ“
â”‚   â”œâ”€â”€ journal/      # æ—¥å¿—ã€å¿«ç…§ã€å¤ç›˜
â”‚   â”œâ”€â”€ market/       # å¸‚åœºæƒ…ç»ªã€çƒ­ç‚¹
â”‚   â”œâ”€â”€ risk/         # é£æ§å¼•æ“
â”‚   â”œâ”€â”€ signals/      # ä¿¡å·è®¡åˆ’å™¨
â”‚   â”œâ”€â”€ storage/      # æ•°æ®åº“å­˜å‚¨
â”‚   â””â”€â”€ strategies/   # ç­–ç•¥å®ç°
â”œâ”€â”€ frontend/         # Next.js å‰ç«¯
â”‚   â”œâ”€â”€ app/          # é¡µé¢
â”‚   â””â”€â”€ lib/          # å·¥å…·å‡½æ•°å’Œ API
â”œâ”€â”€ configs/          # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ app.yaml      # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ strategies/   # ç­–ç•¥é…ç½®
â””â”€â”€ data/             # SQLite æ•°æ®åº“
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.10+
- Node.js 18+
- npm æˆ– yarn

### å®‰è£…å’Œå¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®åè¿›å…¥ç›®å½•
cd BigA

# 2. åˆ›å»º Python è™šæ‹Ÿç¯å¢ƒå¹¶å®‰è£…ä¾èµ–
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r backend/requirements.txt

# 3. å®‰è£…å‰ç«¯ä¾èµ–
cd frontend
npm install
cd ..

# 4. å¯åŠ¨æœåŠ¡ï¼ˆä¸¤ç§æ–¹å¼ï¼‰

# æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
chmod +x start.sh
./start.sh

# æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨
# ç»ˆç«¯1 - å¯åŠ¨åç«¯
python start_backend.py

# ç»ˆç«¯2 - å¯åŠ¨å‰ç«¯
cd frontend && npm run dev
```

### è®¿é—®åœ°å€
- å‰ç«¯é¡µé¢: http://localhost:3000
- åç«¯ API: http://localhost:8000
- API æ–‡æ¡£: http://localhost:8000/docs

## é…ç½®è¯´æ˜

### åº”ç”¨é…ç½® (`configs/app.yaml`)

```yaml
runtime:
  refresh_sec: 10          # æ•°æ®åˆ·æ–°é—´éš”
  max_data_lag_sec: 20     # æœ€å¤§æ•°æ®å»¶è¿Ÿ

market:
  pct_limit_up: 0.095      # æ¶¨åœåˆ¤å®šé˜ˆå€¼
  pct_near_limit_up: 0.092 # æ¥è¿‘æ¶¨åœé˜ˆå€¼

event_approx:
  limit_up_eps: 0.0005     # æ¶¨åœå®¹å·®
  window_m: 30             # ç»Ÿè®¡çª—å£ï¼ˆåˆ†é’Ÿï¼‰
```

### ç­–ç•¥é…ç½® (`configs/strategies/*.yaml`)

ç­–ç•¥å‚æ•°åŒ…æ‹¬ï¼š
- `market_gate`: å¸‚åœºé—¨æ§›ï¼ˆé£é™©ç¯ã€ç‚¸æ¿ç‡ï¼‰
- `stock_filter`: ä¸ªè‚¡è¿‡æ»¤ï¼ˆæˆäº¤é¢ã€æµåŠ¨æ€§ï¼‰
- `scoring`: è¯„åˆ†æƒé‡
- `trigger`: è§¦å‘æ¡ä»¶
- `plan`: æ‰§è¡Œè®¡åˆ’
- `risk`: é£æ§è§„åˆ™

## ä½¿ç”¨æµç¨‹

### 1. å¼€ç›˜å‰ (9:00-9:30)
- é€‰æ‹©ç­–ç•¥ç»„ï¼ˆå›å°ä¸» / é¦–å°ä¿å®ˆï¼‰
- è®¾ç½®é£é™©æ¡£ä½
- å…³æ³¨çš„é¢˜æï¼ˆå¯é€‰ï¼‰

### 2. ç›˜ä¸­
- æŸ¥çœ‹å¸‚åœºæƒ…ç»ªä»ªè¡¨ç›˜
- å…³æ³¨å€™é€‰æ± æ’åº
- å¤„ç†æç¤ºå¡ï¼ˆå‡ºç° ALLOW æ—¶å†³ç­–ï¼‰
- è®°å½•æ‰§è¡Œç»“æœ

### 3. æ”¶ç›˜å
- æŸ¥çœ‹å¤ç›˜é¡µé¢
- æ ‡è®°æç¤ºå¡ç»“æœï¼ˆæˆåŠŸ/å¤±è´¥/è·³è¿‡ï¼‰
- åˆ†æå¤±è´¥æ¨¡å¼
- è°ƒæ•´ç­–ç•¥å‚æ•°

## API æ¥å£

### REST API
- `GET /api/market/dashboard` - å¸‚åœºä»ªè¡¨ç›˜
- `GET /api/candidates` - å€™é€‰æ± 
- `GET /api/alerts` - æç¤ºå¡åˆ—è¡¨
- `PATCH /api/alerts/{id}/label` - æ›´æ–°æç¤ºå¡æ ‡ç­¾
- `GET /api/portfolio/positions` - æŒä»“åˆ—è¡¨
- `GET /api/risk/state` - é£æ§çŠ¶æ€
- `GET /api/replay/snapshot/{id}` - å¿«ç…§å›æ”¾

### WebSocket
- `ws://localhost:8000/ws/stream` - å®æ—¶æ¨é€

## æ™ºèƒ½ä½“/å¤§æ¨¡å‹å¯¹æ¥ï¼ˆAgent Integrationï¼‰

æœ¬å·¥å…·æ”¯æŒä¸ Cozeã€Dify ç­‰æ™ºèƒ½ä½“å¹³å°å¯¹æ¥ï¼Œé€šè¿‡å¤§è¯­è¨€æ¨¡å‹å¢å¼ºä¿¡å·è§£é‡Šå’Œå†³ç­–èƒ½åŠ›ã€‚

### Agent åŠŸèƒ½

| Agent ç±»å‹ | åŠŸèƒ½è¯´æ˜ | çŠ¶æ€ |
|-----------|---------|------|
| **MarketState** | å¸‚åœºçŠ¶æ€è§£é‡Šï¼Œé£é™©ç¯å»ºè®® | å¯ç”¨ |
| **SignalExplain** | ç”Ÿæˆå¯æ‰§è¡Œæç¤ºå¡ï¼ˆæ ¸å¿ƒï¼‰ | å¯ç”¨ |
| **ThemeHeat** | é¢˜æçƒ­åº¦åˆ†æ | å¯é€‰ |
| **RiskCoach** | é£æ§å»ºè®®å¢å¼º | å¯é€‰ |
| **ReviewAnalyst** | å¤ç›˜å½’å› åˆ†æ | å¯é€‰ |

### Agent API æ¥å£

```bash
# æµ‹è¯•è¿é€šæ€§
GET /api/agent/test

# è·å–è¾“å…¥æ•°æ®åŒ…ï¼ˆç»™ Agent ç”¨ï¼‰
GET /api/agent/input_bundle?symbol=300058&strategy_id=reseal_v1

# æ¥æ”¶ Agent è¾“å‡ºï¼ˆAgent å›å†™ï¼‰
POST /api/agent/apply_output
Body: {"type": "SignalExplain", "payload": {...}}
```

### å¿«é€Ÿå¯¹æ¥ Coze/Dify

1. **é…ç½® HTTP æ’ä»¶**ï¼šæŒ‡å‘ `http://YOUR_IP:8000/api/agent/*`
2. **é…ç½® LLM èŠ‚ç‚¹**ï¼šä½¿ç”¨ç»“æ„åŒ– JSON è¾“å‡º
3. **é…ç½®å·¥ä½œæµ**ï¼š`è·å–è¾“å…¥ â†’ LLMå¤„ç† â†’ å›å†™è¾“å‡º`

è¯¦ç»†æ–‡æ¡£è§ï¼š[é€šç”¨Agentéœ€æ±‚æ–‡æ¡£](./é€šç”¨Agentéœ€æ±‚æ–‡æ¡£_Aè‚¡æ‰“æ¿å·¥å…·_Coze-Dify_v0.2.md)

### ç¤ºä¾‹ï¼šæœ¬åœ°æµ‹è¯• Agent æµç¨‹

```bash
# 1. è·å–è¾“å…¥
curl -s "http://localhost:8000/api/agent/input_bundle?symbol=300058" | jq .

# 2. æ¨¡æ‹Ÿ Agent è¾“å‡º
curl -X POST http://localhost:8000/api/agent/apply_output \
  -H "Content-Type: application/json" \
  -d '{
    "type": "SignalExplain",
    "payload": {
      "agent": "SignalExplain",
      "symbol": "300058",
      "action": "WATCH",
      "confidence": 0.75,
      "triggers": [
        {"name": "ç¯å¢ƒé—¨æ§›", "status": "PASS", "detail": "é»„ç¯ï¼Œç‚¸æ¿ç‡0.22<=0.30"}
      ],
      "plan": {
        "max_single_position": 0.10,
        "entry_note": "é»„ç¯å°ä»“ä½è§‚å¯Ÿ",
        "exit_rules": ["å¼€æ¿30sä¸å›å°æ”¾å¼ƒ", "å›æ’¤è¶…0.20åœæ­¢", "çº¢ç¯åœæ­¢æ–°å¢"]
      },
      "one_liner": "å›å°è´¨é‡è¾¾æ ‡ï¼Œé»„ç¯å°ä»“ä½å…è®¸"
    }
  }'

# 3. æŸ¥çœ‹ç”Ÿæˆçš„æç¤ºå¡
curl -s http://localhost:8000/api/alerts?limit=1 | jq .
```

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®æº**: ä½¿ç”¨ akshareï¼ˆä¸œæ–¹è´¢å¯Œï¼‰è·å–å®æ—¶æ•°æ®ã€‚
2. **æ•°æ®å»¶è¿Ÿ**: å½“æ•°æ®å»¶è¿Ÿè¶…è¿‡é˜ˆå€¼æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç¦æ­¢ ALLOW è¾“å‡ºã€‚
3. **éè‡ªåŠ¨äº¤æ˜“**: æœ¬å·¥å…·ä»…æä¾›æç¤ºï¼Œä¸æ‰§è¡Œè‡ªåŠ¨äº¤æ˜“ã€‚
4. **é£æ§ä¼˜å…ˆ**: çº¢ç¯ç¯å¢ƒä¸‹ç¦æ­¢ä»»ä½• ALLOW è¾“å‡ºã€‚
5. **Agent é™çº§**: å½“æ•°æ®å¼‚å¸¸æ—¶ï¼ŒAgent ä¹Ÿå¿…é¡»éµå¾ªé™çº§è§„åˆ™ã€‚

## è®¸å¯è¯

ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ã€‚
