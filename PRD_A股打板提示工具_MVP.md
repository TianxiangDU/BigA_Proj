# PRDï½œAè‚¡æ‰“æ¿æç¤ºä¸ªäººå·¥å…·ï¼ˆå›å°ä¸»ç­–ç•¥ + é¦–å°ä¿å®ˆç­–ç•¥ï¼Œç§»åŠ¨ç«¯æ”¯æŒï¼‰
ç‰ˆæœ¬ï¼šv1.0.0ï¼ˆMVP å®ç°å®Œæˆï¼‰  
æ—¥æœŸï¼š2026-01-12  
å®šä½ï¼šä¸ªäººè‡ªç”¨ç›˜ä¸­"é€‰è‚¡/æ‰“æ¿æç¤º"å·¥å…·ï¼ˆä¸è‡ªåŠ¨ä¸‹å•ï¼Œåç»­å¯è¿­ä»£ï¼‰  
æ•°æ®æ¥å£ï¼š`adata`ï¼ˆç”± Adapter å±‚å°è£…ï¼‰

> æœ¬æ–‡æ¡£å¯ç›´æ¥äº¤ç»™ Cursor ç”Ÿæˆå·¥ç¨‹éª¨æ¶ä¸å®ç°ã€‚æ–‡æ¡£å†…çš„é˜ˆå€¼/æƒé‡å‡å¯åœ¨ `configs/strategies/*.yaml` ä¸ `configs/app.yaml` ä¸­è°ƒæ•´ã€‚

---

## ä¿®æ”¹è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä¿®æ”¹å†…å®¹ |
|------|------|----------|
| v1.0.0 | 2026-01-12 | MVP å¼€å‘å®Œæˆï¼ŒåŒ…å«å®Œæ•´åç«¯ï¼ˆFastAPI + SQLiteï¼‰å’Œå‰ç«¯ï¼ˆNext.js + TailwindCSSï¼‰å®ç° |
| v0.1 | 2026-01-12 | åˆå§‹ PRD ç‰ˆæœ¬ |

### v1.0.0 å®ç°è¯´æ˜

**å·²å®ç°åŠŸèƒ½ï¼š**
1. âœ… æ•°æ®å±‚ï¼šadata Adapter å°è£…ï¼Œæ”¯æŒæ¨¡æ‹Ÿæ•°æ®é™çº§
2. âœ… æ•°æ®è´¨é‡ï¼šäº¤æ˜“æ—¥å†ã€æ•°æ®å»¶è¿Ÿæ£€æµ‹ã€é™çº§ç­–ç•¥
3. âœ… ç‰¹å¾å¼•æ“ï¼šä¸ªè‚¡ç‰¹å¾ + å¸‚åœºç‰¹å¾ + äº‹ä»¶è¿‘ä¼¼ç®—æ³•
4. âœ… å¸‚åœºæƒ…ç»ªï¼šæƒ…ç»ªä»ªè¡¨ç›˜ + é£é™©ç¯ + é¢˜æè¿½è¸ª
5. âœ… ç­–ç•¥ä¸­å¿ƒï¼šå›å°ä¸»ç­–ç•¥ reseal_v1 + é¦–å°ä¿å®ˆç­–ç•¥ firstseal_guard_v1
6. âœ… ä¿¡å·è®¡åˆ’ï¼šå€™é€‰æ± æ’åº + æç¤ºå¡ç”Ÿæˆ + è§¦å‘æ¡ä»¶è¯„ä¼°
7. âœ… é£æ§å¼•æ“ï¼šä»“ä½æ§åˆ¶ + è¿äºåœæ‰‹ + å›æ’¤æ§åˆ¶
8. âœ… æ—¥å¿—å¤ç›˜ï¼šå¿«ç…§ç®¡ç† + æç¤ºå¡å†å² + å¤±è´¥åˆ†æ
9. âœ… REST APIï¼šå®Œæ•´çš„ CRUD æ¥å£
10. âœ… WebSocketï¼šå®æ—¶æ¨é€ dashboard/candidates/alerts
11. âœ… å‰ç«¯é¡µé¢ï¼šDashboard/Pool/Alerts/Portfolio/Review
12. âœ… å“åº”å¼è®¾è®¡ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯

**æŠ€æœ¯å®ç°è°ƒæ•´ï¼š**
- å‰ç«¯ä½¿ç”¨çº¯ TailwindCSS å®ç°ç»„ä»¶ï¼Œæœªå¼•å…¥å®Œæ•´ shadcn/uiï¼ˆå‡å°‘ä¾èµ–ï¼‰
- å›¾è¡¨ä½¿ç”¨ Rechartsï¼ˆå·²é…ç½®ï¼Œå¯åœ¨éœ€è¦æ—¶å¯ç”¨ï¼‰
- PWA æ”¯æŒé¢„ç•™ï¼ˆmanifest é…ç½®å·²å‡†å¤‡ï¼‰

**å¯åŠ¨æ–¹å¼ï¼š**
```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬
./start.sh

# æ–¹å¼äºŒï¼šåˆ†åˆ«å¯åŠ¨
python start_backend.py  # åç«¯ http://localhost:8000
cd frontend && npm run dev  # å‰ç«¯ http://localhost:3000
```

---

## 1. èƒŒæ™¯ä¸ç›®æ ‡
### 1.1 èƒŒæ™¯
æ‰“æ¿äº¤æ˜“çš„å…³é”®é“¾è·¯æ˜¯ï¼š**å¸‚åœºæƒ…ç»ª/é¢˜æ â†’ å€™é€‰æ±  â†’ è§¦å‘å™¨ï¼ˆå›å°/é¦–å°ï¼‰â†’ ä»“ä½é£æ§ â†’ å¤ç›˜æ²‰æ·€**ã€‚çº¯äººå·¥ç›¯ç›˜æ•ˆç‡ä½ã€å®¹æ˜“è¿èƒŒçºªå¾‹ã€å¤ç›˜ç¼ºå°‘â€œå¯å›æ”¾è¯æ®â€ã€‚

### 1.2 ç›®æ ‡ï¼ˆMVPï¼‰
- ç›˜ä¸­å®æ—¶äº§å‡ºï¼š**å€™é€‰æ± ï¼ˆTopNï¼‰+ å¯æ‰§è¡Œæç¤ºå¡ï¼ˆä¹°ä»€ä¹ˆ/æ€ä¹ˆåš/å¤±è´¥æ€ä¹ˆåŠï¼‰**
- æç¤ºå¡å¿…é¡»ï¼š**å¯è§£é‡Š**ï¼ˆè§¦å‘æ¡ä»¶æ¸…å• âœ…/âŒï¼‰ä¸**å¯å›æ”¾**ï¼ˆsnapshot_idï¼‰
- æ”¯æŒï¼š**çƒ­ç‚¹/æƒ…ç»ª/ä¿¡æ¯æµ**å±•ç¤ºï¼ˆå…ˆåšåŸºç¡€ä¿¡æ¯é¢æ¿ï¼Œæ•°æ®ä¸å¤Ÿå¯é™çº§ï¼‰
- æ”¯æŒï¼š**ç§»åŠ¨ç«¯**ï¼ˆå“åº”å¼å¸ƒå±€ + å¯é€‰ PWAï¼‰

### 1.3 éç›®æ ‡ï¼ˆMVPä¸åšï¼‰
- è‡ªåŠ¨ä¸‹å•/è‡ªåŠ¨äº¤æ˜“ï¼ˆä»…æç¤ºã€è®¡åˆ’ã€é£æ§å»ºè®®ï¼‰
- å¤šç”¨æˆ·/å¤šè´¦æˆ·
- è¶…é«˜é¢‘ç›˜å£æ·±åº¦é˜Ÿåˆ—çº§ L2ï¼ˆå…ˆç”¨åˆ†é’Ÿçº§/äº‹ä»¶çº§ï¼Œåç»­å¢å¼ºï¼‰

---

## 2. ç”¨æˆ·ç”»åƒä¸æ ¸å¿ƒä½¿ç”¨æµç¨‹
### 2.1 ç”¨æˆ·ç”»åƒ
- å•ç”¨æˆ·ï¼šæœ¬äºº
- åœºæ™¯ï¼šå¼€ç›˜å‰é€‰ç­–ç•¥/é£é™©æ¡£ï¼›ç›˜ä¸­ç›¯å€™é€‰ä¸æç¤ºï¼›ç›˜åå¤ç›˜ä¸è°ƒå‚

### 2.2 æ¯æ—¥æµç¨‹
1) å¼€ç›˜å‰ï¼ˆ9:00-9:30ï¼‰ï¼šé€‰æ‹©ç­–ç•¥ç»„ï¼ˆå›å°ä¸» / é¦–å°ä¿å®ˆï¼‰+ é£é™©æ¡£ä½ï¼ˆæ¿€è¿›/å‡è¡¡/ä¿å®ˆï¼‰+ å…³æ³¨é¢˜æï¼ˆå¯ç©ºï¼‰  
2) ç›˜ä¸­ï¼šæŸ¥çœ‹æƒ…ç»ªä¸çƒ­ç‚¹ â†’ å€™é€‰æ±  â†’ æç¤ºå¡ï¼ˆå‡ºç°æ‰å¤„ç†ï¼‰ â†’ è®°å½•æ‰§è¡Œ/æŒä»“ï¼ˆæ‰‹å·¥ï¼‰  
3) æ”¶ç›˜åï¼šå¤ç›˜é¡µè‡ªåŠ¨æ±‡æ€»ï¼šæˆåŠŸ/å¤±è´¥æ ·æœ¬ã€å¸¸è§å¤±è´¥æ¨¡å¼ã€å‚æ•°å»ºè®®  

---

## 3. æ€»ä½“åŠŸèƒ½èŒƒå›´
### 3.1 åŠŸèƒ½æ¨¡å—ï¼ˆè½åœ°ç‰ˆï¼‰
1) **æ•°æ®å±‚ï¼ˆData Ingestionï¼‰**
   - é€šè¿‡ adata Adapter æ‹‰å–åˆ†é’ŸK/åŸºç¡€è¡Œæƒ…/ï¼ˆå¯é€‰ï¼‰å…¬å‘Š/æ–°é—»/æ¿å—æ•°æ®
   - æœ¬åœ°ç¼“å­˜ä¸å¢é‡æ›´æ–°

2) **æ•°æ®è´¨é‡ä¸äº¤æ˜“æ—¥å†ï¼ˆData QA & Calendarï¼‰**
   - äº¤æ˜“æ—¥ã€äº¤æ˜“æ—¶æ®µï¼ˆé›†åˆç«ä»·ã€è¿ç»­ç«ä»·ã€åˆä¼‘ï¼‰
   - æ•°æ®å»¶è¿Ÿ/ç¼ºå¤±æ£€æµ‹
   - é™çº§ç­–ç•¥ï¼šå½“æ•°æ®å¼‚å¸¸æ—¶ç¦æ­¢è¾“å‡ºâ€œALLOWâ€ï¼Œæœ€å¤šè¾“å‡º â€œWATCH/BLOCKâ€

3) **ç‰¹å¾/æŒ‡æ ‡å¼•æ“ï¼ˆFeature Engineï¼‰**
   - ç»Ÿä¸€è®¡ç®—ä¸ªè‚¡ç‰¹å¾ï¼ˆåˆ†æ—¶å¼ºåº¦ã€å›æ’¤ã€æ”¾é‡ç­‰ï¼‰
   - ç»Ÿä¸€è®¡ç®—å¸‚åœºç‰¹å¾ï¼ˆæ¶¨åœ/ç‚¸æ¿ã€è¿æ¿é«˜åº¦ç­‰ï¼‰
   - ç¼“å­˜åˆ° features è¡¨ï¼Œæ”¯æŒå›æ”¾

4) **å¸‚åœºæƒ…ç»ªä¸çƒ­ç‚¹ï¼ˆMarket Regime & Themeï¼‰**
   - æƒ…ç»ªä»ªè¡¨ç›˜ï¼šæ¶¨åœæ•°ã€ç‚¸æ¿ç‡ã€è¿æ¿é«˜åº¦ã€è·Œåœæ•°ï¼ˆå°½é‡å®ç°ï¼‰
   - çƒ­ç‚¹é¢˜æï¼šTopN é¢˜æå¼ºåº¦ + ä»£è¡¨è‚¡ï¼ˆæ•°æ®ä¸è¶³æ—¶æä¾›â€œæ‰‹å·¥é¢˜æ/è‡ªé€‰é¢˜æâ€é™çº§ï¼‰

5) **ç­–ç•¥ä¸­å¿ƒï¼ˆStrategy Hubï¼‰**
   - ç­–ç•¥ç»„ï¼šå›å°ä¸»ç­–ç•¥ + é¦–å°ä¿å®ˆç­–ç•¥ï¼ˆå‡å¯æ‰§è¡Œï¼‰
   - ç­–ç•¥é…ç½® YAML/JSON åŒ–ã€å¯ç‰ˆæœ¬åŒ–ã€å¯å¯¹æ¯”

6) **ä¿¡å·ä¸è®¡åˆ’ï¼ˆSignal & Planï¼‰**
   - è¾“å‡ºï¼šå€™é€‰æ± æ’åº + æ¯åªè§¦å‘çŠ¶æ€ï¼ˆæœªè§¦å‘/æ¥è¿‘/è§¦å‘ï¼‰
   - è§¦å‘æ—¶è¾“å‡ºâ€œæç¤ºå¡â€ï¼šåŠ¨ä½œï¼ˆWATCH/ALLOW/BLOCKï¼‰+ ä»“ä½å»ºè®® + å¤±è´¥æ¡ä»¶ + è§£é‡Š

7) **ä¸ªäººæŒä»“ä¸é£æ§ï¼ˆPortfolio Store + Risk Engineï¼‰**
   - æ‰‹å·¥ç»´æŠ¤æŒä»“ï¼ˆæ•°é‡/æˆæœ¬/å¯ç”¨èµ„é‡‘ï¼‰
   - ä»“æ§ï¼šæ€»ä»“ä¸Šé™ã€å•ç¥¨ä¸Šé™ã€è¿äºåœæ‰‹ã€å½“æ—¥å›æ’¤åœæ‰‹

8) **æ—¥å¿—ã€å¿«ç…§ä¸å¤ç›˜ï¼ˆJournal & Replayï¼‰**
   - æ¯æ¬¡å€™é€‰æ± åˆ·æ–°å¯æŒ‰éœ€å†™ snapshotï¼ˆå»ºè®®ï¼šä»…åœ¨è§¦å‘/æ¥è¿‘è§¦å‘æ—¶å†™ï¼‰
   - æ¯æ¬¡æç¤ºå¡å¿…å†™ snapshot_id + card_json
   - å¤ç›˜ï¼šæŒ‰ç­–ç•¥ç»Ÿè®¡ã€æ ·æœ¬å›æ”¾ã€å‚æ•°å»ºè®®ï¼ˆè§„åˆ™ç‰ˆ/æ™ºèƒ½ä½“ç‰ˆå‡å¯ï¼‰

---

## 4. äº§å“ä¿¡æ¯æ¶æ„ï¼ˆIAï¼‰ä¸é¡µé¢è®¾è®¡
### 4.1 é¡µé¢ç»“æ„ï¼ˆWeb + Mobile Responsiveï¼‰
- ä¸»é¡µ Dashboardï¼ˆæƒ…ç»ª/çƒ­ç‚¹/ä¿¡æ¯æµ/é£é™©ç¯ï¼‰
- å€™é€‰æ±  Stock Poolï¼ˆTopN è¡¨æ ¼ + ç­›é€‰/æ’åº/è‡ªé€‰ï¼‰
- æç¤ºå¡ Alertsï¼ˆå®æ—¶å¡ç‰‡æµ + å†å²ï¼‰
- æŒä»“ä¸é£æ§ Portfolio & Risk
- å¤ç›˜ä¸å›æ”¾ Review & Replay
- è®¾ç½® Settingsï¼ˆç­–ç•¥ç»„ã€å‚æ•°ã€é»‘åå•ã€é€šçŸ¥ï¼‰

### 4.2 UI/UX é£æ ¼è§„èŒƒï¼ˆâ€œå¥½çœ‹â€è½åœ°ï¼‰
**ç›®æ ‡ï¼š**ç®€æ´ã€ä¿¡æ¯å¯†åº¦é«˜ä½†ä¸å‹è¿«ï¼Œé€‚é…æ‰‹æœºå•æ‰‹æ“ä½œã€‚

**è§†è§‰è§„èŒƒ**
- å¸ƒå±€ï¼šå¡ç‰‡åŒ– + åˆ†åŒºæ ‡é¢˜ + è½»è¾¹æ¡† + æŸ”å’Œé˜´å½±
- å­—ä½“ï¼šæ ‡é¢˜ 18-22ã€æ­£æ–‡ 14-16ã€è¾…åŠ© 12-13ï¼ˆç§»åŠ¨ç«¯ç•¥å¢å¤§ï¼‰
- é¢œè‰²ï¼šä¸»è‰²è“ï¼›é£é™©ç»¿/é»„/çº¢ï¼›æ¶¨è·Œçº¢/ç»¿ï¼ˆå¯é…ç½®ï¼‰
- ç»„ä»¶ï¼šshadcn/uiï¼ˆCardã€Badgeã€Tabsã€Tableã€Dialogã€Toastï¼‰
- å›¾è¡¨ï¼šRechartsï¼ˆæŠ˜çº¿/æŸ±çŠ¶/é¢ç§¯å›¾ï¼‰

**äº¤äº’è§„èŒƒ**
- ä»»ä½•â€œå…è®¸æ‰§è¡Œâ€çš„æç¤ºå¿…é¡»ï¼šä¸€çœ¼çœ‹åˆ° **åŠ¨ä½œ + ä»“ä½ + å¤±è´¥æ¡ä»¶**
- è¡¨æ ¼æ”¯æŒï¼šæœç´¢ã€ç­›é€‰ï¼ˆé¢˜æ/é˜¶æ®µ/ç­–ç•¥ï¼‰ã€æ”¶è—ï¼ˆâ­è‡ªé€‰ï¼‰ã€å¿½ç•¥ï¼ˆğŸš«é»‘åå•ï¼‰
- ç§»åŠ¨ç«¯ï¼šåº•éƒ¨ Tab Barï¼ˆDashboard/Pool/Alerts/Portfolio/Reviewï¼‰

**å“åº”å¼**
- Desktopï¼šä¸‰åˆ—å¸ƒå±€ï¼ˆæƒ…ç»ª&çƒ­ç‚¹ | å€™é€‰æ±  | æç¤ºå¡ï¼‰
- Tabletï¼šä¸¤åˆ—å¸ƒå±€ï¼ˆæƒ…ç»ª&çƒ­ç‚¹ ä¸Šæ–¹ï¼Œå€™é€‰æ± +æç¤ºå¡ ä¸‹æ–¹ Tabsï¼‰
- Mobileï¼šå•åˆ— + Tabs + å¡ç‰‡åˆ—è¡¨ï¼ˆä¼˜å…ˆ Alerts ä¸ Poolï¼‰

---

## 5. æŠ€æœ¯æ¶æ„ï¼ˆå»ºè®®ç»™ Cursor å›ºåŒ–ï¼‰
### 5.1 æ¨èæŠ€æœ¯æ ˆï¼ˆæ”¯æŒâ€œå¥½çœ‹ + ç§»åŠ¨ç«¯â€ï¼‰
- å‰ç«¯ï¼šNext.js + TailwindCSS + shadcn/ui + Rechartsï¼ˆå“åº”å¼ + PWA å¯é€‰ï¼‰
- åç«¯ï¼šFastAPIï¼ˆPythonï¼‰
- å­˜å‚¨ï¼šSQLiteï¼ˆMVPï¼‰â†’ åç»­å¯æ¢ DuckDB/Postgres
- å®æ—¶ï¼šWebSocketï¼ˆæ¨é€å€™é€‰æ± æ›´æ–°ã€æç¤ºå¡ï¼‰
- å®šæ—¶ä»»åŠ¡ï¼šAPSchedulerï¼ˆæ‹‰å–æ•°æ®ã€è®¡ç®—ç‰¹å¾ã€ç”Ÿæˆå€™é€‰ï¼‰
- é€šçŸ¥ï¼šWeb Push / Telegram/ä¼ä¸šå¾®ä¿¡ï¼ˆå¯é€‰ï¼‰

### 5.2 ç›®å½•ç»“æ„ï¼ˆå»ºè®®ï¼‰
- `backend/`
  - `adapters/adata_provider.py`
  - `core/calendar.py`
  - `core/qa.py`
  - `features/engine.py`
  - `market/regime.py`
  - `market/themes.py`
  - `strategies/registry.py`
  - `strategies/reseal_v1.py`
  - `strategies/firstseal_guard_v1.py`
  - `signals/planner.py`
  - `risk/engine.py`
  - `storage/db.py` `storage/models.py`
  - `journal/snapshot.py` `journal/alerts.py` `journal/replay.py`
  - `api/main.py` (REST + WS)
- `frontend/`
  - `app/` pages: dashboard/pool/alerts/portfolio/review/settings
  - `components/` cards/tables/charts
  - `lib/api.ts` websocket client
- `configs/`
  - `app.yaml`
  - `strategies/reseal_v1.yaml`
  - `strategies/firstseal_guard_v1.yaml`

---

## 6. æ•°æ®ä¸å­˜å‚¨è®¾è®¡ï¼ˆSQLiteï¼‰
### 6.1 æ ¸å¿ƒè¡¨ï¼ˆMVPï¼‰
1) `bars_1m(ts, symbol, o,h,l,c, volume, amount, source)` unique(symbol, ts)  
2) `features(ts, symbol, feat_json)` index(symbol, ts)  
3) `market_features(ts, feat_json)` index(ts)  
4) `strategy_registry(strategy_id, name, type, version, params_json, enabled)`  
5) `candidate_snapshots(snapshot_id, ts, market_feat_json, candidates_json, selected_theme_json, strategy_id)`  
6) `alerts(alert_id, ts, symbol, strategy_id, action, card_json, snapshot_id, user_label)`  
7) `portfolio_positions(symbol, qty, avg_cost, updated_at)`  
8) `risk_state(ts, state_json)`  

### 6.2 å¿«ç…§ç­–ç•¥ï¼ˆé™ä½å†™å…¥å‹åŠ›ï¼‰
- å€™é€‰æ± åˆ·æ–°ä¸å¿…æ¯æ¬¡å†™ snapshot
- **å½“å‡ºç° â€œæ¥è¿‘è§¦å‘/å·²è§¦å‘â€ æˆ– é£é™©ç¯å˜åŒ–** æ—¶å†™ snapshot
- æ¯æ¡ alert å¿…é¡»å†™ snapshotï¼ˆå¼ºåˆ¶ï¼‰

---

## 7. ç‰¹å¾å­—æ®µæ¸…å•ï¼ˆfeatures.feat_json / market_features.feat_jsonï¼‰
> å­—æ®µç¼ºå¤±å¿…é¡»å¯é™çº§ï¼Œä¸¥ç¦å› ç¼ºå­—æ®µå¯¼è‡´ç­–ç•¥æŠ¥é”™ã€‚ç¼ºå­—æ®µæ—¶è¦ï¼šå†™å…¥ `null` + åœ¨è§£é‡Šé‡Œæ ‡è®°â€œå·²é™çº§â€ã€‚

### 7.1 ä¸ªè‚¡ç‰¹å¾ï¼ˆåˆ†é’Ÿçº§å¯å®ç°ï¼‰
- `ret_1m, ret_5m, ret_15m`ï¼šæ”¶ç›Šç‡
- `slope_5m, slope_10m`ï¼šè¿‘Nåˆ†é’Ÿçº¿æ€§æ–œç‡ï¼ˆå¼ºåº¦ï¼‰
- `pullback_5m`ï¼šè¿‘Nåˆ†é’Ÿä»é«˜ç‚¹å›æ’¤æ¯”ä¾‹
- `vol_ratio_5m`ï¼šè¿‘5mæˆäº¤é‡ / è¿‡å»Xåˆ†é’Ÿå‡å€¼
- `amt`ï¼šå½“æ—¥æˆäº¤é¢ï¼ˆç´¯è®¡ï¼‰
- `amt_5m`ï¼šè¿‘5mæˆäº¤é¢
- `range_5m`ï¼šè¿‘5mæŒ¯å¹…
- `new_high_cnt_30m`ï¼š30må†…åˆ›æ–°é«˜æ¬¡æ•°
- `near_limit_up`ï¼šæ˜¯å¦æ¥è¿‘æ¶¨åœï¼ˆé˜ˆå€¼å¯é…ï¼‰
- `limit_up_price`ï¼šæ¶¨åœä»·ï¼ˆå¦‚å¯å¾—ï¼‰
- `is_limit_up`ï¼šå½“å‰æ˜¯å¦æ¶¨åœï¼ˆåŸºäºä»·æ ¼ç­‰äºæ¶¨åœä»·åˆ¤æ–­ï¼‰

#### ä¸å›å°/é¦–å°ç›¸å…³çš„â€œäº‹ä»¶è¿‘ä¼¼ç‰¹å¾â€ï¼ˆå¯ç”±åˆ†é’Ÿçº¿æ¨æ–­ï¼‰
- `touch_limit_up_30m`ï¼š30må†…æ˜¯å¦è§¦åŠæ¶¨åœï¼ˆè¿‘ä¼¼ï¼‰
- `open_count_30m`ï¼š30må†…â€œå¼€æ¿æ¬¡æ•°â€ï¼ˆè¿‘ä¼¼ï¼‰
- `reseal_speed_sec`ï¼šå¼€æ¿â†’å›å°è€—æ—¶ï¼ˆè¿‘ä¼¼ï¼‰
- `reseal_stable_min`ï¼šå›å°åç¨³å®šåˆ†é’Ÿæ•°ï¼ˆè¿‘ä¼¼ï¼‰
- `first_seal_minute`ï¼šé¦–æ¬¡å°æ¿å‘ç”Ÿçš„åˆ†é’Ÿç´¢å¼•ï¼ˆè¿‘ä¼¼ï¼Œå¯é€‰ï¼‰
- `liquidity_score`ï¼šæµåŠ¨æ€§è¯„åˆ†ï¼ˆåŸºäº amtã€æ³¢åŠ¨ã€æˆäº¤å¯†åº¦ï¼‰

### 7.2 å¸‚åœºç‰¹å¾ï¼ˆmarket_features.feat_jsonï¼‰
- `limit_up_count`ï¼šæ¶¨åœå®¶æ•°ï¼ˆæ•°æ®ä¸è¶³å¯ç”¨è¿‘ä¼¼ï¼šæ¶¨å¹…â‰¥9.5%ï¼‰
- `touch_limit_up_count`ï¼šè§¦åŠæ¶¨åœå®¶æ•°ï¼ˆè¿‘ä¼¼ï¼‰
- `bomb_rate`ï¼šç‚¸æ¿ç‡ï¼ˆè¿‘ä¼¼ï¼šè§¦åŠæ¶¨åœåæœªä¿æŒ/æ”¶ç›˜æ¶¨åœï¼‰
- `max_streak`ï¼šè¿æ¿é«˜åº¦ï¼ˆMVPå¯å…ˆç®€åŒ–æˆ–ç½®ç©ºï¼‰
- `down_limit_count`ï¼šè·Œåœæ•°ï¼ˆè¿‘ä¼¼ï¼šè·Œå¹…â‰¤-9.5%ï¼‰
- `index_ret_15m`ï¼šæŒ‡æ•°è¿‘15mæ¶¨è·Œï¼ˆå¯é€‰ï¼‰
- `regime_mode`ï¼šè§„åˆ™åˆ¤æ–­ STRONG/DIVERGENCE/WEAK/CHAOS
- `risk_light`ï¼šGREEN/YELLOW/RED

---

## 8. äº‹ä»¶è¿‘ä¼¼ç®—æ³•ï¼ˆä»…ç”¨åˆ†é’Ÿçº¿æ¨æ–­â€œè§¦åŠæ¶¨åœ/å¼€æ¿/å›å°/ç¨³å®šâ€ï¼‰
> ç›®çš„ï¼šåœ¨ç¼ºå°‘å®Œæ•´æ¶¨åœäº‹ä»¶æµ/å°å•æ•°æ®çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶è®©å›å°ç­–ç•¥èƒ½è·‘èµ·æ¥ã€‚åç»­æ¥å…¥æ›´ç²¾ç»†æ•°æ®æ—¶ï¼Œåªéœ€æ›¿æ¢è¯¥æ¨¡å—è¾“å‡ºã€‚

### 8.1 å…³é”®å‚æ•°ï¼ˆå¯é…ç½®ï¼‰
- `limit_up_eps`: åˆ¤å®šâ€œæ¶¨åœâ€çš„å®¹å·®ï¼ˆé»˜è®¤ 0.0005ï¼Œå³ 0.05%ï¼‰
- `near_limit_up_eps`: åˆ¤å®šâ€œæ¥è¿‘æ¶¨åœâ€çš„å®¹å·®ï¼ˆé»˜è®¤ 0.003ï¼Œå³ 0.3%ï¼‰
- `min_open_gap`: åˆ¤å®šå¼€æ¿çš„ä»·æ ¼è„±ç¦»å¹…åº¦ï¼ˆé»˜è®¤ 0.001ï¼Œå³ 0.1%ï¼‰
- `window_m`: ç»Ÿè®¡çª—å£åˆ†é’Ÿæ•°ï¼ˆé»˜è®¤ 30ï¼‰

### 8.2 éœ€è¦çš„æ•°æ®
- åˆ†é’ŸK closeï¼ˆæœ€å¥½æœ‰ high/lowï¼‰
- `limit_up_price`ï¼ˆèƒ½å–åˆ°åˆ™ç”¨ï¼›å–ä¸åˆ°åˆ™ç”¨æ¶¨è·Œå¹…é˜ˆå€¼è¿‘ä¼¼ï¼‰

### 8.3 å®šä¹‰
**è‹¥æœ‰ `limit_up_price`:**
- `is_limit_up(t)`ï¼š`abs(close(t) - limit_up_price) / limit_up_price <= limit_up_eps`
- `near_limit_up(t)`ï¼š`(limit_up_price - close(t)) / limit_up_price <= near_limit_up_eps`

**è‹¥æ—  `limit_up_price`:**
- ç”¨æ¶¨å¹…è¿‘ä¼¼ï¼š`is_limit_up(t) := pct_change_from_prev_close(t) >= 9.5%`
- `near_limit_up(t) := pct_change >= 9.2%`ï¼ˆå¯é…ç½®ï¼‰

### 8.4 è§¦åŠæ¶¨åœï¼ˆtouchï¼‰
- `touch_limit_up`ï¼šåœ¨çª—å£å†…å­˜åœ¨ `high(t)` è§¦åŠæ¶¨åœï¼ˆè‹¥æ—  high åˆ™ç”¨ close è§¦åŠï¼‰

### 8.5 å¼€æ¿ï¼ˆopenï¼‰ä¸å›å°ï¼ˆresealï¼‰
åœ¨çª—å£å†…å¯¹ `is_limit_up` åºåˆ—åšçŠ¶æ€æœºï¼š
- `STATE = SEALED` å½“ `is_limit_up=True`
- `STATE = OPEN` å½“ `is_limit_up=False` ä¸”æ›¾ç» `SEALED` ä¸” `close` ä½äºæ¶¨åœä»·è¶…è¿‡ `min_open_gap`
- è®°å½•æ¯æ¬¡ `SEALED -> OPEN` ä½œä¸ºä¸€æ¬¡å¼€æ¿ï¼Œ`open_count_30m += 1`
- è‹¥ä¹‹åå‡ºç° `OPEN -> SEALED`ï¼Œåˆ™åˆ¤å®šâ€œå›å°â€
  - `reseal_speed_sec = (t_reseal - t_open) * 60`
  - `reseal_stable_min`: ä» `t_reseal` èµ·è¿ç»­ä¿æŒ `SEALED` çš„åˆ†é’Ÿæ•°ï¼ˆç›´åˆ°å†æ¬¡ OPEN æˆ–çª—å£ç»“æŸï¼‰

### 8.6 é‡è¦é™çº§è¯´æ˜
- åˆ†é’Ÿçº¿æ¨æ–­æ— æ³•è¯†åˆ«â€œä¸€åˆ†é’Ÿå†…å¼€æ¿åˆå›å°â€ï¼Œè¿™æ˜¯å¯æ¥å—çš„ MVP è¯¯å·®ã€‚
- åç»­è‹¥æ¥å…¥é€ç¬”æˆ–æ›´ç»†ç²’åº¦æ•°æ®ï¼šæ›¿æ¢ `limit_events` ç”Ÿæˆé€»è¾‘å³å¯ï¼Œç­–ç•¥å±‚ä¸å˜ã€‚

---

## 9. å€™é€‰æ± è¯„åˆ†å…¬å¼ï¼ˆå¯é…ç½®ï¼Œé»˜è®¤æƒé‡ç»™å®šï¼‰
> ç›®çš„ï¼šè®©å€™é€‰æ± ä¸ä»…æ˜¯â€œæ»¡è¶³æ¡ä»¶çš„é›†åˆâ€ï¼Œè€Œæ˜¯æŒ‰â€œæœŸæœ›è´¨é‡â€æ’åºï¼Œå‡å°‘ä½ ç›¯ç›˜è´Ÿæ‹…ã€‚è¯„åˆ†å¿…é¡»å¯è§£é‡Šã€å¯å›æ”¾ã€‚

### 9.1 æ€»åˆ†ç»“æ„
`TotalScore = MarketScore + ThemeScore + StockScore + QualityScore - RiskPenalty`  
å„é¡¹èŒƒå›´å»ºè®®å½’ä¸€åŒ–åˆ° 0~100ï¼ˆæˆ– 0~1ï¼‰ï¼Œæœ€ç»ˆè¾“å‡º 0~100 çš„æ€»åˆ†ã€‚

### 9.2 é»˜è®¤æƒé‡ï¼ˆå¯åœ¨ç­–ç•¥ YAML è°ƒæ•´ï¼‰
- `w_market = 0.35`
- `w_theme  = 0.25`
- `w_stock  = 0.25`
- `w_quality= 0.15`
- `risk_penalty` ç›´æ¥æ‰£åˆ†ï¼ˆ0~30ï¼‰

### 9.3 åˆ†é¡¹å®šä¹‰ï¼ˆMVPè§„åˆ™ç‰ˆï¼‰
#### 9.3.1 MarketScoreï¼ˆ0~100ï¼‰
ç”±å¸‚åœºæƒ…ç»ªæŒ‡æ ‡æ˜ å°„ï¼š
- æ¶¨åœæ•° `limit_up_count`ï¼šè¶Šå¤šè¶Šé«˜ï¼ˆåˆ†æ®µæ˜ å°„ï¼‰
- ç‚¸æ¿ç‡ `bomb_rate`ï¼šè¶Šä½è¶Šé«˜ï¼ˆåå‘æ˜ å°„ï¼‰
- è·Œåœæ•° `down_limit_count`ï¼šè¶Šå°‘è¶Šé«˜ï¼ˆåå‘æ˜ å°„ï¼‰
- ï¼ˆå¯é€‰ï¼‰æŒ‡æ•° 15mï¼šæ­£å‘åŠ åˆ†ï¼Œè´Ÿå‘å‡åˆ†

å»ºè®®åˆ†æ®µï¼ˆé»˜è®¤ï¼‰ï¼š
- `limit_up_count`: <20(20åˆ†), 20-40(60åˆ†), >40(85åˆ†)
- `bomb_rate`: >0.40(10åˆ†), 0.25-0.40(50åˆ†), <0.25(80åˆ†)
- `down_limit_count`: >15(10åˆ†), 5-15(50åˆ†), <5(80åˆ†)

#### 9.3.2 ThemeScoreï¼ˆ0~100ï¼‰
MVPä¸¤ç§æ¨¡å¼ï¼š
- è‹¥æœ‰é¢˜ææ•°æ®ï¼šé¢˜æå¼ºåº¦ï¼ˆæ¶¨åœå®¶æ•°/æ¿å—æ¶¨å¹…/æŒç»­æ€§ï¼‰
- è‹¥æ— é¢˜ææ•°æ®ï¼šé™çº§ä¸ºâ€œç”¨æˆ·é€‰ä¸­é¢˜æåŠ æƒâ€ + â€œåŒæ¶¨åœç”Ÿæ€çš„èšç±»è¿‘ä¼¼â€ï¼ˆå¯ååšï¼‰
é»˜è®¤ï¼šç”¨æˆ·å…³æ³¨é¢˜æåŠ  10~20 åˆ†ï¼›éå…³æ³¨ä¸åŠ åˆ†ä¸æ‰£åˆ†ã€‚

#### 9.3.3 StockScoreï¼ˆ0~100ï¼‰
ç”±åˆ†æ—¶å¼ºåº¦ä¸æ‰¿æ¥å®šä¹‰ï¼š
- `slope_5m` æ˜ å°„ï¼ˆå¼ºåº¦ï¼‰
- `pullback_5m` åå‘æ˜ å°„ï¼ˆå›æ’¤è¶Šå°è¶Šå¥½ï¼‰
- `vol_ratio_5m` æ˜ å°„ï¼ˆæ”¾é‡ç¡®è®¤ï¼‰
- `new_high_cnt_30m`ï¼ˆåˆ›æ–°é«˜å¤šåŠ åˆ†ï¼‰
- `amt`ï¼ˆæµåŠ¨æ€§åŠ åˆ†ï¼‰

ç¤ºä¾‹æ˜ å°„ï¼ˆé»˜è®¤ï¼‰ï¼š
- slope_5m: <=0.10(10), 0.10-0.30(50), >0.30(80)
- pullback_5m: >=0.25(10), 0.12-0.25(50), <0.12(80)
- vol_ratio_5m: <1.2(20), 1.2-2.0(60), >2.0(85)

#### 9.3.4 QualityScoreï¼ˆ0~100ï¼‰
ç”¨äºâ€œå°æ¿/å›å°è´¨é‡â€ï¼ŒMVPç”¨è¿‘ä¼¼ç‰¹å¾ï¼š
- å›å°ï¼š`reseal_speed_sec` è¶Šå¿«è¶Šå¥½ï¼ˆ<=30s é«˜åˆ†ï¼Œ<=60s ä¸­é«˜ï¼‰
- å›å°ç¨³å®šï¼š`reseal_stable_min` è¶Šå¤§è¶Šå¥½
- å¼€æ¿æ¬¡æ•°ï¼š`open_count_30m` è¶Šå°‘è¶Šå¥½

ç¤ºä¾‹æ˜ å°„ï¼ˆé»˜è®¤ï¼‰ï¼š
- reseal_speed_sec: <=30(85), 30-60(70), 60-120(40), >120(10)
- reseal_stable_min: >=3(85), 1-3(60), <1(20)
- open_count_30m: 0(85), 1(70), 2(50), >=3(20)

#### 9.3.5 RiskPenaltyï¼ˆ0~30ï¼‰
- æ•°æ®é™çº§ï¼ˆç¼ºå­—æ®µ/å»¶è¿Ÿï¼‰æ‰£ 10~30
- æµåŠ¨æ€§ä¸è¶³ï¼ˆamt<é˜ˆå€¼ï¼‰æ‰£ 10~20
- ç¯å¢ƒçº¢ç¯ç›´æ¥ BLOCKï¼ˆä¸è¯„åˆ†æˆ–è®°ä¸º -infï¼‰
- é»‘åå•ç›´æ¥ BLOCK

### 9.4 ç»¿/é»„/çº¢ç¯çš„â€œç³»æ•°æŠ˜å‡â€
- GREENï¼šç³»æ•° 1.0
- YELLOWï¼šç³»æ•° 0.75ï¼ˆæ€»åˆ†ä¸ä»“ä½ä¸Šé™å‡æŠ˜å‡ï¼‰
- REDï¼šç¦æ­¢ ALLOWï¼ˆä»… WATCH/BLOCKï¼‰ï¼Œæ€»åˆ†å¯æ˜¾ç¤ºä½†æ ‡çº¢

---

## 10. ç­–ç•¥ç³»ç»Ÿï¼šå›å°ä¸»ç­–ç•¥ + é¦–å°ä¿å®ˆç­–ç•¥ï¼ˆå¯æ‰§è¡Œï¼‰
### 10.1 ç­–ç•¥é€šç”¨æ¦‚å¿µ
- `Universe`ï¼šå…¨Aè‚¡ï¼ˆè¿‡æ»¤ ST/é€€å¸‚é£é™©/åœç‰Œç­‰ï¼‰
- `Candidate Filter`ï¼šæµåŠ¨æ€§/æˆäº¤é¢/é£é™©æ ‡ç­¾è¿‡æ»¤
- `Scoring`ï¼šæ€»åˆ†æ’åºï¼Œè¾“å‡º TopN
- `Trigger`ï¼šå›å°æˆ–é¦–å°è§¦å‘å™¨
- `Plan`ï¼šä»“ä½å»ºè®® + å¤±è´¥æ¡ä»¶ï¼ˆé€€å‡ºçºªå¾‹ï¼‰

### 10.2 å›å°ä¸»ç­–ç•¥ï¼ˆreseal_v1ï¼‰
**ALLOW æ¡ä»¶ï¼ˆé»˜è®¤å…¨æ»¡è¶³ï¼‰ï¼š**
- ç¯å¢ƒï¼š`risk_light != RED` ä¸” `bomb_rate <= 0.30`
- å›å°ï¼š`reseal_speed_sec <= 60`
- ç¨³å®šï¼š`reseal_stable_min >= 1`
- å¼ºåº¦ï¼š`slope_5m >= 0.25` ä¸” `pullback_5m <= 0.18`
- æµåŠ¨æ€§ï¼š`amt >= 80,000,000` ä¸” `liquidity_score >= 0.60`
- å¼€æ¿æ¬¡æ•°ï¼š`open_count_30m <= 3`

**WATCHï¼š**
- ç¯å¢ƒé€šè¿‡ï¼Œä½†å›å°/ç¨³å®š/å¼ºåº¦åªæ»¡è¶³éƒ¨åˆ†ï¼ˆè¾“å‡ºç¼ºé¡¹ï¼‰

**BLOCKï¼š**
- ç¯å¢ƒçº¢ç¯ï¼Œæˆ–æ•°æ®å»¶è¿Ÿ/ç¼ºå¤±è§¦å‘ç¦åšï¼Œæˆ–é»‘åå•ï¼Œæˆ–æµåŠ¨æ€§è¿‡ä½

**æ‰§è¡Œè®¡åˆ’ï¼ˆé»˜è®¤ï¼‰ï¼š**
- å•ç¥¨ä¸Šé™ï¼šç»¿ 0.15ï¼Œé»„ 0.10ï¼Œçº¢ 0
- å¤±è´¥æ¡ä»¶ï¼šå¼€æ¿å 30s ä¸å›å°ï¼ˆæ”¾å¼ƒ/å‡ä»“ï¼‰ï¼›å›æ’¤æ‰©å¤§ï¼›é£é™©ç¯è½¬çº¢åœæ­¢æ–°å¢

### 10.3 é¦–å°ä¿å®ˆç­–ç•¥ï¼ˆfirstseal_guard_v1ï¼Œå¯æ‰§è¡Œï¼‰
**ALLOW æ¡ä»¶ï¼ˆé»˜è®¤ï¼‰ï¼š**
- ç¯å¢ƒï¼š`risk_light == GREEN` ä¸” `bomb_rate <= 0.25`
- é¦–å°ï¼š`is_limit_up == true` ä¸” `open_count_30m <= 1`
- æ”¾é‡ï¼š`vol_ratio_5m >= 1.8`
- æ‰¿æ¥ï¼š`pullback_5m <= 0.12` ä¸” `slope_5m >= 0.20`
- æµåŠ¨æ€§ï¼š`amt >= 120,000,000` ä¸” `liquidity_score >= 0.70`

**æ‰§è¡Œè®¡åˆ’ï¼ˆé»˜è®¤ï¼‰ï¼š**
- å•ç¥¨ä¸Šé™ï¼šç»¿ 0.10ï¼ˆé»„/çº¢é»˜è®¤ä¸åšï¼Œè‹¥æ”¾å®½åˆ™é»„ 0.05ï¼‰
- å¤±è´¥æ¡ä»¶ï¼šå¼€æ¿ä¸å›å°ç›´æ¥æ”¾å¼ƒ

---

## 11. ç­–ç•¥é…ç½®æ ¼å¼ï¼ˆYAML ç¤ºä¾‹ï¼‰
### 11.1 `configs/strategies/reseal_v1.yaml`
```yaml
strategy_id: "reseal_v1"
name: "å›å°ä¸»ç­–ç•¥"
type: "RULE"
version: "1.0.0"
params:
  market_gate:
    max_bomb_rate: 0.30
    disallow_risk_light: ["RED"]
  stock_filter:
    min_amount: 80000000
    min_liquidity_score: 0.60
    max_open_cnt_30m: 3
  scoring:
    w_market: 0.35
    w_theme: 0.25
    w_stock: 0.25
    w_quality: 0.15
    yellow_score_factor: 0.75
  trigger:
    reseal_window_sec: 60
    min_stable_min: 1
    min_slope_5m: 0.25
    max_pullback_5m: 0.18
  plan:
    max_single_pos_green: 0.15
    max_single_pos_yellow: 0.10
    max_single_pos_red: 0.00
    fail_window_sec: 30
risk:
  stop_after_consecutive_losses: 3
  daily_max_drawdown: 0.03
```

### 11.2 `configs/strategies/firstseal_guard_v1.yaml`
```yaml
strategy_id: "firstseal_guard_v1"
name: "é¦–å°ä¿å®ˆç­–ç•¥ï¼ˆå¯æ‰§è¡Œï¼‰"
type: "RULE"
version: "1.0.0"
params:
  market_gate:
    allow_risk_light: ["GREEN"]
    max_bomb_rate: 0.25
  stock_filter:
    min_amount: 120000000
    min_liquidity_score: 0.70
    max_open_cnt_30m: 1
  scoring:
    w_market: 0.40
    w_theme: 0.20
    w_stock: 0.25
    w_quality: 0.15
  trigger:
    min_vol_ratio_5m: 1.8
    max_pullback_5m: 0.12
    min_slope_5m: 0.20
  plan:
    max_single_pos_green: 0.10
    max_single_pos_yellow: 0.05
    fail_window_sec: 20
risk:
  stop_after_consecutive_losses: 2
  daily_max_drawdown: 0.02
```

---

## 12. æ•°æ®è´¨é‡ä¸é™çº§ç­–ç•¥ï¼ˆå¿…é¡»å†™æ­»ï¼‰
- è‹¥ `bars_1m` æœ€æ–°æ—¶é—´æˆ³è½åå½“å‰æ—¶é—´ > `max_data_lag_sec`ï¼ˆé»˜è®¤ 20 ç§’ï¼‰ï¼š
  - ç¦æ­¢è¾“å‡º `ALLOW`
  - å€™é€‰æ± ä»å¯å±•ç¤ºï¼Œä½†æ‰€æœ‰åŠ¨ä½œä¸Šé™ä¸º WATCH/BLOCK
  - Dashboard æ˜¾ç¤ºâ€œæ•°æ®å»¶è¿Ÿâ€æ¨ªå¹…
- è‹¥å…³é”®å­—æ®µç¼ºå¤±ï¼š
  - è§¦å‘å™¨æ”¹ç”¨æ›¿ä»£ç‰¹å¾ï¼ˆå°å•ç¼ºå¤±â†’ç”¨ç¨³å®šåˆ†é’Ÿæ•°/å›å°é€Ÿåº¦/æˆäº¤é¢ä»£ç†ï¼‰
  - åœ¨æç¤ºå¡ triggers ä¸­æ˜ç¡®æ ‡æ³¨â€œå·²é™çº§â€
- ä¸¥ç¦å› ç¼ºå¤±å­—æ®µå¯¼è‡´ç­–ç•¥æŠ¥é”™ï¼šç¼ºå­—æ®µå³ `null` + é™çº§é€»è¾‘

**å»ºè®® `configs/app.yaml`ï¼š**
```yaml
runtime:
  refresh_sec: 10
  max_data_lag_sec: 20
market:
  pct_limit_up: 0.095      # æ— æ¶¨åœä»·æ—¶çš„æ¶¨åœè¿‘ä¼¼é˜ˆå€¼
  pct_near_limit_up: 0.092 # æ¥è¿‘æ¶¨åœé˜ˆå€¼
event_approx:
  limit_up_eps: 0.0005
  near_limit_up_eps: 0.003
  min_open_gap: 0.001
  window_m: 30
```

---

## 13. API è®¾è®¡ï¼ˆFastAPIï¼‰
### 13.1 REST
- `GET /api/market/dashboard`
- `GET /api/candidates?strategy_id=&top=30`
- `GET /api/alerts?limit=200`
- `POST /api/portfolio/positions`
- `GET /api/risk/state`
- `GET /api/replay/snapshot/{snapshot_id}`
- `POST /api/settings/strategies/reload`

### 13.2 WebSocket
- `/ws/stream`
  - æ¨é€ï¼šdashboardã€candidatesã€alertsã€risk_state

---

## 14. æ™ºèƒ½ä½“æ¥å£ï¼ˆåç»­æ¥å…¥ï¼ŒI/O åè®®ï¼‰
> App è´Ÿè´£ï¼šæ•°æ®/ç‰¹å¾/å€™é€‰/å¿«ç…§/è½åº“/å±•ç¤º  
> Agent è´Ÿè´£ï¼šå¸‚åœºçŠ¶æ€/çƒ­ç‚¹å½’çº³/ä¿¡å·è§£é‡Š/å¤ç›˜å½’å› ï¼ˆå¯é€æ­¥æ¥å…¥ï¼‰

### 14.1 App â†’ Agent è¾“å…¥ï¼ˆinput_bundleï¼‰
`POST /agent/input_bundle`
```json
{
  "ts": "2026-01-12T10:05:00+08:00",
  "market": { "limit_up_count": 42, "bomb_rate": 0.22, "max_streak": 4, "down_limit_count": 3, "risk_light": "YELLOW" },
  "themes": [{"name":"AIåº”ç”¨","strength":0.78,"leaders":["000001","300xxx"]}],
  "candidates": [
    {"symbol":"300xxx","name":"ç¤ºä¾‹è‚¡","tags":["AIåº”ç”¨","å›å°"],"features":{"slope_5m":0.63,"pullback_5m":0.12,"amt":120000000,"reseal_speed_sec":45,"reseal_stable_min":1}}
  ],
  "portfolio": {"positions":[{"symbol":"600xxx","qty":1000,"avg_cost":12.3}], "cash": 50000},
  "strategy_context": {"strategy_id":"reseal_v1","risk_profile":"balanced","selected_themes":["AIåº”ç”¨"]}
}
```

### 14.2 Agent â†’ App è¾“å‡ºï¼ˆMVPå…ˆæ¥å…¥ SignalExplainï¼‰
```json
{
  "agent": "SignalExplain",
  "ts": "2026-01-12T10:06:00+08:00",
  "symbol": "300xxx",
  "action": "WATCH | ALLOW | BLOCK",
  "confidence": 0.82,
  "triggers": [
    {"name":"ç¯å¢ƒé—¨æ§›","status":"PASS","detail":"YELLOWä¸”ç‚¸æ¿ç‡0.22<=0.30"},
    {"name":"å›å°é€Ÿåº¦","status":"PASS","detail":"45s<=60s"},
    {"name":"ç¨³å®šæ€§","status":"PASS","detail":"å›å°ç¨³å®š>=1min"}
  ],
  "plan": {
    "max_single_position": 0.10,
    "entry_note": "ä»…åœ¨å†æ¬¡å›å°ä¸”ç¨³å®šæ€§ä¸ä¸‹é™æ—¶æ‰§è¡Œ",
    "exit_rules": ["å¼€æ¿30sä¸å›å°=>æ”¾å¼ƒ/å‡ä»“","å›æ’¤æ‰©å¤§>é˜ˆå€¼=>åœæ­¢è¿½"]
  },
  "risks": ["é¢˜æåˆ†æ­§æ‰©å¤§å°†æå‡ç‚¸æ¿æ¦‚ç‡"],
  "one_liner": "å›å°è´¨é‡è¾¾æ ‡ï¼Œé»„ç¯å°ä»“ä½å…è®¸ï¼Œä¸¥æ ¼æ‰§è¡Œå¤±è´¥æ¡ä»¶ã€‚",
  "snapshot_hint": {"should_create_snapshot": true, "snapshot_tags":["reseal","main_theme"]}
}
```

---

## 15. éªŒæ”¶æ ‡å‡†ï¼ˆMVPï¼‰
1) ç§»åŠ¨ç«¯å¯ç”¨ï¼šDashboard/Pool/Alerts/Portfolio/Review å‡å¯æ­£å¸¸æµè§ˆä¸æ“ä½œ  
2) å€™é€‰æ± æ¯ 10 ç§’åˆ·æ–°ï¼Œå»¶è¿Ÿæ£€æµ‹ç”Ÿæ•ˆ  
3) å›å°ç­–ç•¥ï¼šè‡³å°‘åœ¨â€œçŠ¶æ€è·³å˜è¿‘ä¼¼äº‹ä»¶â€ä¸‹èƒ½äº§å‡ºè§¦å‘æç¤ºå¡  
4) é¦–å°ç­–ç•¥ï¼šåœ¨ç»¿ç¯ç¯å¢ƒä¸‹èƒ½äº§å‡ºå¯æ‰§è¡Œæç¤ºï¼ˆéçº¯ WATCHï¼‰  
5) æ¯æ¡ alert å¿…æœ‰ snapshot_idï¼Œä¸”å›æ”¾é¡µé¢èƒ½è¿˜åŸå½“æ—¶ç¯å¢ƒä¸å€™é€‰æ±   
6) é£æ§ï¼šçº¢ç¯ç¦åšã€è¿äº/å›æ’¤åœæ‰‹é€»è¾‘å¯é…ç½®å¯ç”Ÿæ•ˆ  

---

## 16. ç»™ Cursor çš„æ€»æŒ‡ä»¤ï¼ˆç›´æ¥å¤åˆ¶ï¼‰
è¯·æŒ‰æœ¬ PRD å®ç°ä¸€ä¸ªæœ¬åœ°è¿è¡Œçš„ Web åº”ç”¨ï¼šå‰ç«¯ Next.js + Tailwind + shadcn/ui + Rechartsï¼Œåç«¯ FastAPI + SQLiteï¼Œå®æ—¶ç”¨ WebSocket æ¨é€ dashboard/candidates/alerts/risk_stateã€‚æ•°æ®æºé€šè¿‡ adata Adapter æ‹‰å–å¹¶å…¥åº“ã€‚å®ç° 8 æ¨¡å—åˆ†å±‚ï¼ˆData/QA/Feature/Market/Strategy/Signal/Risk/Journalï¼‰ã€‚å®ç°ä¸¤å¥—ç­–ç•¥ï¼šå›å°ä¸»ç­–ç•¥ reseal_v1ã€é¦–å°ä¿å®ˆç­–ç•¥ firstseal_guard_v1ï¼ˆå‡å¯æ‰§è¡Œï¼‰ã€‚ä¸¥æ ¼å®ç°æ•°æ®å»¶è¿Ÿé™çº§ï¼šæ•°æ®å»¶è¿Ÿæ—¶ç¦æ­¢è¾“å‡º ALLOWã€‚æ¯æ¡ alert å¿…é¡»ç»‘å®š snapshot_idï¼Œå¹¶æ”¯æŒå›æ”¾é¡µé¢æŒ‰ snapshot_id è¿˜åŸå½“æ—¶ç¯å¢ƒä¸å€™é€‰æ± ã€‚å®ç°â€œä»…ç”¨åˆ†é’Ÿçº¿è¿‘ä¼¼æ¨æ–­å¼€æ¿/å›å°â€æ¨¡å—ï¼ˆè§ç¬¬8ç« ï¼‰ï¼Œåç»­å¯æ›¿æ¢ä¸ºæ›´ç²¾ç»†äº‹ä»¶æºã€‚æä¾›æœ¬åœ°å¯åŠ¨è„šæœ¬ã€ç¤ºä¾‹é…ç½®ï¼ˆconfigs/app.yaml + strategies/*.yamlï¼‰ã€‚
